# Email Agent - Intelligent Email Processing System

An AI-powered email processing system that automatically categorizes incoming emails and generates appropriate responses, saving them as Gmail drafts for review.

## Features

- **Gmail Integration**: Securely connects to Gmail using OAuth2
- **AI-Powered Processing**: Uses OpenAI GPT-4o for email categorization and response generation
- **Draft Generation**: Creates professional email responses and saves them as Gmail drafts
- **Intelligent Categorization**: Automatically categorizes emails (business, personal, support, etc.)
- **RESTful API**: FastAPI-based API for easy integration
- **Extensible Architecture**: Ready for future enhancements (Slack, ToDoist, PDF parsing)

## Quick Start

### Prerequisites

- Python 3.11 or higher
- Google Cloud Project with Gmail API enabled
- OpenAI API key
- Gmail account

### Installation

1. **Clone and setup the project:**
   ```bash
   git clone <repository-url>
   cd email_agent
   python -m venv .venv
   source .venv/bin/activate  # On Windows: .venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. **Setup environment variables:**
   ```bash
   cp .env.example .env
   # Edit .env with your API keys and credentials
   ```

3. **Generate Gmail OAuth2 tokens:**
   ```bash
   python -m email_agent.scripts.generate_gmail_token
   ```

4. **Start the server:**
   ```bash
   uvicorn email_agent.app.main:app --reload
   ```

5. **Access the API:**
   - API Documentation: http://localhost:8000/docs
   - Health Check: http://localhost:8000/health

## Configuration

### Required Environment Variables

```env
# OpenAI API Configuration
OPENAI_API_KEY=sk-your-openai-api-key-here

# Gmail OAuth2 Configuration (generated by setup script)
GMAIL_REFRESH_TOKEN=your-gmail-refresh-token-here
GOOGLE_CLIENT_ID=your-google-client-id-here.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret-here

# Application Security
SECRET_KEY=your-secret-key-here-generate-a-secure-one
```

### Optional Environment Variables

```env
# Logging
LOG_LEVEL=INFO
LOG_DIR=./logs

# External Services (for future extensions)
TODOIST_API_KEY=your-todoist-api-key-here
SLACK_BOT_TOKEN=xoxb-your-slack-bot-token-here
```

## API Endpoints

### Core Endpoints

- `GET /health` - Health check and service status
- `POST /emails/process-and-save-drafts` - Process unread emails and create drafts
- `GET /emails/unread` - Get unread emails without processing
- `GET /emails/drafts` - Get existing Gmail drafts
- `POST /emails/categorize` - Categorize a single email

### Example Usage

```bash
# Process unread emails and create drafts
curl -X POST "http://localhost:8000/emails/process-and-save-drafts" \
  -H "Content-Type: application/json" \
  -d '{"max_emails": 5, "mark_as_read": false}'

# Get health status
curl "http://localhost:8000/health"

# Get unread emails
curl "http://localhost:8000/emails/unread?max_results=10"
```

## Project Structure

```
email_agent/
├── app/                 # FastAPI application
│   ├── __init__.py
│   └── main.py          # Main FastAPI app with endpoints
├── agent/               # AI processing logic
│   ├── __init__.py
│   └── processor.py     # Email categorization and response generation
├── mail/                # Gmail client
│   ├── __init__.py
│   └── gmail_client.py  # Gmail API interactions
├── core/                # Core utilities
│   ├── __init__.py
│   └── logger.py        # Logging configuration
├── api/                 # API extensions (future)
│   └── __init__.py
├── scripts/             # Utility scripts
│   ├── __init__.py
│   └── generate_gmail_token.py  # OAuth2 token generation
├── tests/               # Test suite
│   └── __init__.py
├── .env.example         # Environment variables template
├── requirements.txt     # Python dependencies
└── README.md           # This file
```

## Email Categories

The system automatically categorizes emails into:

- **business**: Business inquiries, partnerships, work-related
- **personal**: Personal messages from friends/family
- **support**: Technical support requests, bug reports
- **sales**: Sales inquiries, product questions
- **invoice**: Invoices, billing, payment-related
- **newsletter**: Newsletters, marketing emails
- **spam**: Spam or unwanted emails
- **urgent**: Urgent matters requiring immediate attention
- **other**: Anything that doesn't fit above categories

## Response Generation

The AI generates contextually appropriate responses based on:
- Email category and content
- Sender information
- Priority level
- Professional tone matching

Responses are saved as Gmail drafts for human review before sending.

## Development

### Running Tests

```bash
# Run all tests
python -m pytest

# Run with coverage
python -m pytest --cov=email_agent
```

### Adding New Features

The system is designed for extensibility:

1. **New AI Models**: Modify `agent/processor.py`
2. **External Integrations**: Add to `api/` directory
3. **New Email Providers**: Add to `mail/` directory
4. **Custom Processing**: Extend `EmailProcessor` class

## Security Notes

- All API credentials are stored in environment variables
- Gmail access uses OAuth2 with refresh tokens
- No emails are automatically sent - only drafts are created
- All operations are logged for audit purposes

## Troubleshooting

### Common Issues

1. **Gmail API Authentication Error**
   - Re-run the token generation script
   - Verify Google Cloud Console settings
   - Check OAuth2 consent screen configuration

2. **OpenAI API Error**
   - Verify API key is valid and has sufficient credits
   - Check rate limits and usage

3. **Import Errors**
   - Ensure virtual environment is activated
   - Install dependencies: `pip install -r requirements.txt`

### Logs

Check application logs for detailed error information:
```bash
# View recent logs
tail -f logs/email_agent_$(date +%Y%m%d).log
```

## Future Enhancements

Planned features for future versions:

- **Slack Integration**: Send notifications to Slack channels
- **ToDoist Integration**: Create tasks from emails
- **PDF Analysis**: Extract and analyze PDF attachments
- **Invoice Processing**: Automated invoice data extraction
- **Email Templates**: Customizable response templates
- **Machine Learning**: Improved categorization with custom models

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Submit a pull request

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Support

For support and questions:
- Check the troubleshooting section
- Review the API documentation at `/docs`
- Check logs for error details
- Open an issue on GitHub